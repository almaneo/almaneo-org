workflows:
  # iOS - Apple Developer 계정 등록 후 활성화
  # ios-release:
  #   name: iOS Release
  #   working_directory: chat-app
  #   max_build_duration: 60
  #   instance_type: mac_mini_m2
  #   environment:
  #     ios_signing:
  #       distribution_type: app_store
  #       bundle_identifier: org.almaneo.almachat
  #     flutter: stable
  #     xcode: latest
  #     groups:
  #       - app_store_credentials
  #     vars:
  #       BUNDLE_ID: "org.almaneo.almachat"
  #   scripts:
  #     - name: Set up code signing settings on Xcode project
  #       script: |
  #         xcode-project use-profiles
  #     - name: Get Flutter packages
  #       script: |
  #         flutter pub get
  #     - name: Build iOS
  #       script: |
  #         flutter build ipa --release \
  #           --build-name=1.0.0 \
  #           --build-number=$PROJECT_BUILD_NUMBER \
  #           --export-options-plist=/Users/builder/export_options.plist
  #   artifacts:
  #     - chat-app/build/ios/ipa/*.ipa
  #   publishing:
  #     app_store_connect:
  #       auth: integration
  #       submit_to_testflight: true
  #       submit_to_app_store: false

  android-build:
    name: Android Build Test
    working_directory: chat-app
    max_build_duration: 30
    instance_type: mac_mini_m2
    environment:
      flutter: stable
      android_signing:
        - almachat_keystore
      groups:
        - app_env
    scripts:
      - name: Create .env file
        script: |
          cat > .env << EOF
          STREAM_API_KEY=$STREAM_API_KEY
          SUPABASE_URL=$SUPABASE_URL
          SUPABASE_ANON_KEY=$SUPABASE_ANON_KEY
          CHAT_API_URL=$CHAT_API_URL
          WEB3AUTH_CLIENT_ID=$WEB3AUTH_CLIENT_ID
          GOOGLE_MAPS_API_KEY=$GOOGLE_MAPS_API_KEY
          EOF
      - name: Create key.properties for signing
        script: |
          cat > android/key.properties << EOF
          storePassword=$CM_KEYSTORE_PASSWORD
          keyPassword=$CM_KEY_PASSWORD
          keyAlias=$CM_KEY_ALIAS
          storeFile=$CM_KEYSTORE_PATH
          EOF
      - name: Get Flutter packages
        script: |
          flutter pub get
      - name: Build AAB
        script: |
          flutter build appbundle --release \
            --build-name=1.0.0 \
            --build-number=$PROJECT_BUILD_NUMBER
    artifacts:
      - chat-app/build/app/outputs/bundle/release/*.aab

  # Google Play 계정 등록 후 publishing 섹션 추가:
  # android-release:
  #   ...
  #   publishing:
  #     google_play:
  #       credentials: $GCLOUD_SERVICE_ACCOUNT_CREDENTIALS
  #       track: internal
  #       submit_as_draft: true
