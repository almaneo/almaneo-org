# AlmaChat V0.5 Plan â€” Social & UX Enhancement

## Overview
AlmaChat v0.5 focuses on **Social & UX Enhancement**: message reactions, user profiles, unread badges, channel management, and deep links. This transforms the app from a basic chat client into a feature-rich social messaging experience.

## Implementation Order
A (Reactions) â†’ C (Unread Badge) â†’ B (Profile/Channel Info) â†’ D (Safety) â†’ E (Deep Links)

---

## Phase A: Message Actions & Reactions (1-2 sessions, ~810 lines)

### Status: âœ… Completed (Session 114-115)

### Goal
Add long-press message actions (copy, delete, reply) and emoji reactions to messages.

### Key Challenge
`TranslatedMessage` (892 lines) is a fully custom widget that **bypasses Stream SDK's built-in message interaction**. We must add interaction layers around this custom widget.

### New Files (3) âœ… Created
1. **`lib/widgets/reaction_picker.dart`** âœ…
2. **`lib/widgets/reaction_bar.dart`** âœ…
3. **`lib/widgets/message_actions_sheet.dart`** âœ…

### Modified Files (4) âœ… All Done
4. **`lib/widgets/translated_message.dart`** âœ…
5. **`lib/screens/chat_screen.dart`** âœ… â€” callbacks, reply wiring, StreamMessageInputController
6. **`lib/screens/meetup_chat_screen.dart`** âœ… â€” same wiring
7. **`lib/l10n/app_strings.dart`** âœ… â€” 6 keys Ã— 15 languages = 90 entries

### Stream SDK APIs Used
- `channel.sendReaction(message, type)` â€” add reaction
- `channel.deleteReaction(message, reaction)` â€” remove reaction
- `channel.deleteMessage(message)` â€” delete message
- `message.reactionGroups` â€” read reaction counts (v9.5+)
- `message.latestReactions` â€” check user's own reactions

---

## Phase C: Unread Badge & Chat UX Polish (1 session, ~230 lines)

### Status: âœ… Completed (Session 115)

### Goal
Show unread message count badge on bottom nav chat tab, add scroll-to-bottom FAB in chat.

### Modified Files (5)
1. **`lib/main.dart`** (~+60 lines)
   - `StreamBuilder` on `client.state.totalUnreadCountStream`
   - Red badge with count on Chat tab icon

2. **`lib/screens/chat_screen.dart`** (~+50 lines)
   - Scroll-to-bottom FAB with new message count badge

3. **`lib/screens/meetup_chat_screen.dart`** (~+50 lines)
   - Same scroll-to-bottom FAB

4. **`lib/screens/channel_list_screen.dart`** (~+20 lines)
   - `channel.markRead()` when channel tapped

5. **`lib/l10n/app_strings.dart`** (~+45 lines)
   - 3 keys Ã— 15 languages

---

## Phase B: User Profile Viewer & Channel Info (1-2 sessions, ~1035 lines)

### Status: âœ… Completed (Session 116)

### Goal
Tap user avatar to see profile sheet. Tap channel name to see channel details.

### New Files (2) âœ… Created
1. **`lib/widgets/user_profile_sheet.dart`** âœ… â€” Bottom sheet (avatar, name, online status, user ID copy, DM button)
2. **`lib/screens/channel_info_screen.dart`** âœ… â€” Full screen (channel name, description, member list with roles, mute/unmute, leave)

### Backend APIs
- Mute/Unmute: Client-side Stream SDK (`channel.mute()`/`channel.unmute()`) â€” no backend needed
- Block user: Deferred to Phase D (Safety)

### Modified Files (5) âœ… All Done
3. `translated_message.dart` âœ… â€” `onAvatarTap` callback
4. `chat_screen.dart` âœ… â€” AppBar title â†’ ChannelInfoScreen, avatar â†’ UserProfileSheet
5. `meetup_chat_screen.dart` âœ… â€” same wiring
6. `find_friends_screen.dart` âœ… â€” tile tap â†’ UserProfileSheet, Chat button â†’ DM
7. `app_strings.dart` âœ… â€” 25 keys Ã— 15 languages = 375 entries

---

## Phase D: Channel Management & Safety (1 session, ~400 lines)

### Status: ðŸ”² Pending

### Goal
Long-press channel tile for actions (pin, mute, leave).

### New Files (1)
1. **`lib/widgets/channel_actions_sheet.dart`** (~150 lines)

### Modified Files (3)
2. `channel_list_screen.dart` â€” onLongPress, pinned sorting
3. `chat_screen.dart` â€” muted indicator
4. `app_strings.dart` â€” 10 keys Ã— 15 languages

---

## Phase E: Deep Links & Polish (1 session, ~188 lines)

### Status: ðŸ”² Pending

### Goal
Handle `almachat://invite/{code}` deep links. Pull-to-refresh.

### New Files (1)
1. **`lib/services/deep_link_service.dart`** (~80 lines)

### Modified Files (4)
2. `main.dart` â€” initialize DeepLinkService
3. `channel_list_screen.dart` â€” RefreshIndicator
4. `pubspec.yaml` â€” `app_links` package
5. `app_strings.dart` â€” 5 keys Ã— 15 languages

---

## Summary

| Phase | New Files | Modified Files | Est. Lines | Sessions | Status |
|-------|-----------|---------------|------------|----------|--------|
| A: Reactions | 3 | 4 | ~810 | 1-2 | âœ… Completed |
| C: Unread Badge | 0 | 4 | ~82 | 1 | âœ… Completed |
| B: Profile/Info | 2 | 5 | ~1,035 | 1 | âœ… Completed |
| D: Safety | 1 | 3 | ~400 | 1 | ðŸ”² Pending |
| E: Deep Links | 1 | 4 | ~188 | 1 | ðŸ”² Pending |
| **Total** | **7 + 2 APIs** | **~15** | **~2,663** | **5-7** | |

## Constraints
- All UI uses `context.alma` semantic tokens (no hardcoded colors)
- All text uses `tr(key, lang)` with 15 languages
- Stream SDK client-side APIs preferred; server-side only for ban/mute requiring auth
- No breaking changes to existing functionality
- `TranslatedMessage` widget extended, not replaced
- Use `reactionGroups` (not deprecated `reactionCounts`) for Stream SDK v9.5+
